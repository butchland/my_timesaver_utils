---

title: My Timesaver utilities


keywords: fastai
sidebar: home_sidebar

summary: "A set of simple utilities I found useful to import "
description: "A set of simple utilities I found useful to import "
nb_path: "nbs/index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is the current list of functions</p>
<ul>
<li>Profiling Utilities<ul>
<li><code>@profile_call(fname=None)</code> - a function or method decorator to record execution times</li>
<li><code>print_prof_data(fname=None)</code> - prints out profile data for function <code>fname</code> or all functions if <code>fname</code> is None</li>
<li><code>clear_prof_data(fname=None)</code> - clears out profile data for function <code>fname</code> or all functions if <code>fname</code> is None</li>
<li><code>get_prof_data(fname)</code> - get exec times for <code>fname</code></li>
<li><code>start_record(fname)</code> - start recording time for <code>fname</code> (alternative to decorator if function cannot decorated)</li>
<li><code>end_record(fname)</code> - stop recording and add elapsed time for <code>fname</code> </li>
<li><code>save_prof_data(file_name)</code> - save profile data to <code>file_name</code></li>
<li><code>load_prof_data(file_name)</code> - load profile data from <code>file_name</code></li>
</ul>
</li>
<li>Profiling Callback<ul>
<li><a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> - a fastai <code>Callback</code> that provides a hierarchical view of model training time execution<ul>
<li><a href="/my_timesaver_utils/profiling_callback.html#Learner.to_my_profile"><code>Learner.to_my_profile</code></a> - method added to a fastai <code>Learner</code> if <code>my_timesaver_utils.profiling_callback</code> is imported. Call it to add a <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> to the <code>Learner</code> instance.</li>
<li><code>Learner.my_profile</code> - <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> instance attached to the fastai <code>Learner</code> object if <code>to_my_profile</code> method is called.</li>
<li><code>print_stats</code> - <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> method to show a hierarchical view of the training lifecycle execution stats (execution counts, avg time, max time)</li>
<li><code>get_stats</code> - <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> method to get the execution stats as a list</li>
<li><code>clear_stats</code> - <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> method to reset the execution stats</li>
<li><code>reset</code> - <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> attribute to set so each call to <code>Learner.fit</code> resets the execution counts before starting the training.</li>
</ul>
</li>
</ul>
</li>
<li>Enhanced Image Classifier Cleaner<ul>
<li><code>class EnhancedImageClassifierCleaner</code> - a drop-in replacement for the <code>fastai.vision.widgets.ImageClassifierCleaner</code> which adds <code>Apply</code> and <code>Reset</code> buttons to allow the user to apply or revert changes to actual dataset.<em>(In the fastai, the application of the changes is done in a separate step, making it more cumbersome to apply across a lot of categories -- doubling it since it segregates the validation and training datasets as well)</em></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install git+https://github.com/butchland/my_timesaver_utils.git</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Profiling-Utils">Profiling Utils<a class="anchor-link" href="#Profiling-Utils"> </a></h3><p>Import the utils -- You can either import all the utilities</p>

<pre><code>from my_timesaver_utils.all import *</code></pre>
<p>Or you can import only the profiling package</p>

<pre><code>from my_timesaver_utils.profiling import *</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Decorate method or function you want to profile</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@profile_call</span>
<span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Call your method or function</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">test_func</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also add an optional funcname if you want to replace the name its stored in the profile data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@profile_call</span><span class="p">(</span><span class="s1">&#39;wachacha&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_func2</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">test_func2</span><span class="p">()</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Print your profile data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_prof_data</span><span class="p">(</span><span class="s1">&#39;test_func&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Function test_func called 20 times.
Execution time max: 1.005, average: 1.003
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Print your profile data for the test_func2 (aka wachacha)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_prof_data</span><span class="p">(</span><span class="s1">&#39;wachacha&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Function wachacha called 3 times.
Execution time max: 1.005, average: 1.004
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get your profile data (e.g. good for graphing)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">times</span> <span class="o">=</span> <span class="n">get_prof_data</span><span class="p">(</span><span class="s1">&#39;test_func&#39;</span><span class="p">);</span> <span class="n">times</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[1.0015828609466553,
 1.0050618648529053,
 1.0031030178070068,
 1.005044937133789,
 1.0005640983581543,
 1.0037250518798828,
 1.005134105682373,
 1.0017268657684326,
 1.0040719509124756,
 1.000154972076416,
 1.0042312145233154,
 1.0004308223724365,
 1.0003941059112549,
 1.004988193511963,
 1.0016610622406006,
 1.000688076019287,
 1.0050456523895264,
 1.0013980865478516,
 1.0050151348114014,
 1.005051851272583]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you can't add a decorator, you can start and end the recording manually and it will be added to the profile data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">start_record</span><span class="p">(</span><span class="s1">&#39;my_sleep&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">end_record</span><span class="p">(</span><span class="s1">&#39;my_sleep&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As an alternative, the decorator can be invoked this way</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sleep</span> <span class="o">=</span> <span class="n">profile_call</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also pass in an optional function name to replace the func name used in the profile data</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sleep2</span> <span class="o">=</span> <span class="n">profile_call</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">,</span> <span class="s1">&#39;maluman&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">sleep2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you call <a href="/my_timesaver_utils/profiling.html#print_prof_data"><code>print_prof_data</code></a> without any arguments, it will print all the timings for all the functions</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_prof_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Function test_func called 20 times.
Execution time max: 1.005, average: 1.003
Function wachacha called 3 times.
Execution time max: 1.005, average: 1.004
Function my_sleep called 10 times.
Execution time max: 1.005, average: 1.002
Function sleep called 5 times.
Execution time max: 4.005, average: 2.003
Function maluman called 3 times.
Execution time max: 1.003, average: 1.002
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also get the profile data for the manually recorded calls as well.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">times2</span> <span class="o">=</span> <span class="n">get_prof_data</span><span class="p">(</span><span class="s1">&#39;sleep&#39;</span><span class="p">);</span><span class="n">times2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[1.1920928955078125e-05,
 1.0048019886016846,
 2.0013680458068848,
 3.0050129890441895,
 4.004997253417969]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also save the profile data to a file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_file</span> <span class="o">=</span> <span class="s1">&#39;my_profile_data.pickle&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_prof_data</span><span class="p">(</span><span class="n">save_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Calling <a href="/my_timesaver_utils/profiling.html#clear_prof_data"><code>clear_prof_data</code></a> for a function will clear out the data for that function</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clear_prof_data</span><span class="p">(</span><span class="s1">&#39;sleep&#39;</span><span class="p">)</span>
<span class="n">print_prof_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Function test_func called 20 times.
Execution time max: 1.005, average: 1.003
Function wachacha called 3 times.
Execution time max: 1.005, average: 1.004
Function my_sleep called 10 times.
Execution time max: 1.005, average: 1.002
Function maluman called 3 times.
Execution time max: 1.003, average: 1.002
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Calling the <a href="/my_timesaver_utils/profiling.html#clear_prof_data"><code>clear_prof_data</code></a> with no arguments will clear out all the previously recorded timings.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clear_prof_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_prof_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can reload the profile data from a previously saved file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_prof_data</span><span class="p">(</span><span class="n">save_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_prof_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Function test_func called 20 times.
Execution time max: 1.005, average: 1.003
Function wachacha called 3 times.
Execution time max: 1.005, average: 1.004
Function my_sleep called 10 times.
Execution time max: 1.005, average: 1.002
Function sleep called 5 times.
Execution time max: 4.005, average: 2.003
Function maluman called 3 times.
Execution time max: 1.003, average: 1.002
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Profiling-Callback">Profiling Callback<a class="anchor-link" href="#Profiling-Callback"> </a></h3><p>Import the utils -- You can either import all the utilities</p>

<pre><code>from my_timesaver_utils.all import *</code></pre>
<p>Or you can import only the profiling callback package</p>

<pre><code>from my_timesaver_utils.profiling_callback import *</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-Usage">Example Usage<a class="anchor-link" href="#Example-Usage"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Import the whole <code>my_timesaver_utils</code> package</p>

<pre><code>from my_timesaver_utils.all import *</code></pre>
<p>or as an alternative, just import the <a href="/my_timesaver_utils/profiling_callback.html"><code>profiling_callback</code></a> package</p>

<pre><code>from my_timesaver_utils.profiling_callback import *</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Setup your path, data, datablock, dataloaders and learner as usual.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_TINY</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Path</span><span class="o">.</span><span class="n">BASE_PATH</span> <span class="o">=</span> <span class="n">path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">datablock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span>
    <span class="n">blocks</span><span class="o">=</span><span class="p">(</span><span class="n">ImageBlock</span><span class="p">,</span><span class="n">CategoryBlock</span><span class="p">),</span>
    <span class="n">get_items</span><span class="o">=</span><span class="n">get_image_files</span><span class="p">,</span>
    <span class="n">get_y</span><span class="o">=</span><span class="n">parent_label</span><span class="p">,</span>
    <span class="n">splitter</span><span class="o">=</span><span class="n">GrandparentSplitter</span><span class="p">(),</span>
    <span class="n">item_tfms</span><span class="o">=</span><span class="n">Resize</span><span class="p">(</span><span class="mi">28</span><span class="p">),</span>
    <span class="n">batch_tfms</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">datablock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span><span class="n">resnet18</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Importing the profiling callback adds a method <code>to_my_profile</code> to the <code>learner</code> object</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">to_my_profile</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;fastai.learner.Learner at 0x139594d10&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Calling the <code>to_my_profile</code> method on the <code>learner</code> object adds a callback called <a href="/my_timesaver_utils/profiling_callback.html#MyProfileCallback"><code>MyProfileCallback</code></a> which can be accessed through the <code>learner</code> attribute <code>my_profile</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Sequential (Input shape: [&#39;64 x 3 x 28 x 28&#39;])
================================================================
Layer (type)         Output Shape         Param #    Trainable 
================================================================
Conv2d               64 x 64 x 14 x 14    9,408      False     
________________________________________________________________
BatchNorm2d          64 x 64 x 14 x 14    128        True      
________________________________________________________________
ReLU                 64 x 64 x 14 x 14    0          False     
________________________________________________________________
MaxPool2d            64 x 64 x 7 x 7      0          False     
________________________________________________________________
Conv2d               64 x 64 x 7 x 7      36,864     False     
________________________________________________________________
BatchNorm2d          64 x 64 x 7 x 7      128        True      
________________________________________________________________
ReLU                 64 x 64 x 7 x 7      0          False     
________________________________________________________________
Conv2d               64 x 64 x 7 x 7      36,864     False     
________________________________________________________________
BatchNorm2d          64 x 64 x 7 x 7      128        True      
________________________________________________________________
Conv2d               64 x 64 x 7 x 7      36,864     False     
________________________________________________________________
BatchNorm2d          64 x 64 x 7 x 7      128        True      
________________________________________________________________
ReLU                 64 x 64 x 7 x 7      0          False     
________________________________________________________________
Conv2d               64 x 64 x 7 x 7      36,864     False     
________________________________________________________________
BatchNorm2d          64 x 64 x 7 x 7      128        True      
________________________________________________________________
Conv2d               64 x 128 x 4 x 4     73,728     False     
________________________________________________________________
BatchNorm2d          64 x 128 x 4 x 4     256        True      
________________________________________________________________
ReLU                 64 x 128 x 4 x 4     0          False     
________________________________________________________________
Conv2d               64 x 128 x 4 x 4     147,456    False     
________________________________________________________________
BatchNorm2d          64 x 128 x 4 x 4     256        True      
________________________________________________________________
Conv2d               64 x 128 x 4 x 4     8,192      False     
________________________________________________________________
BatchNorm2d          64 x 128 x 4 x 4     256        True      
________________________________________________________________
Conv2d               64 x 128 x 4 x 4     147,456    False     
________________________________________________________________
BatchNorm2d          64 x 128 x 4 x 4     256        True      
________________________________________________________________
ReLU                 64 x 128 x 4 x 4     0          False     
________________________________________________________________
Conv2d               64 x 128 x 4 x 4     147,456    False     
________________________________________________________________
BatchNorm2d          64 x 128 x 4 x 4     256        True      
________________________________________________________________
Conv2d               64 x 256 x 2 x 2     294,912    False     
________________________________________________________________
BatchNorm2d          64 x 256 x 2 x 2     512        True      
________________________________________________________________
ReLU                 64 x 256 x 2 x 2     0          False     
________________________________________________________________
Conv2d               64 x 256 x 2 x 2     589,824    False     
________________________________________________________________
BatchNorm2d          64 x 256 x 2 x 2     512        True      
________________________________________________________________
Conv2d               64 x 256 x 2 x 2     32,768     False     
________________________________________________________________
BatchNorm2d          64 x 256 x 2 x 2     512        True      
________________________________________________________________
Conv2d               64 x 256 x 2 x 2     589,824    False     
________________________________________________________________
BatchNorm2d          64 x 256 x 2 x 2     512        True      
________________________________________________________________
ReLU                 64 x 256 x 2 x 2     0          False     
________________________________________________________________
Conv2d               64 x 256 x 2 x 2     589,824    False     
________________________________________________________________
BatchNorm2d          64 x 256 x 2 x 2     512        True      
________________________________________________________________
Conv2d               64 x 512 x 1 x 1     1,179,648  False     
________________________________________________________________
BatchNorm2d          64 x 512 x 1 x 1     1,024      True      
________________________________________________________________
ReLU                 64 x 512 x 1 x 1     0          False     
________________________________________________________________
Conv2d               64 x 512 x 1 x 1     2,359,296  False     
________________________________________________________________
BatchNorm2d          64 x 512 x 1 x 1     1,024      True      
________________________________________________________________
Conv2d               64 x 512 x 1 x 1     131,072    False     
________________________________________________________________
BatchNorm2d          64 x 512 x 1 x 1     1,024      True      
________________________________________________________________
Conv2d               64 x 512 x 1 x 1     2,359,296  False     
________________________________________________________________
BatchNorm2d          64 x 512 x 1 x 1     1,024      True      
________________________________________________________________
ReLU                 64 x 512 x 1 x 1     0          False     
________________________________________________________________
Conv2d               64 x 512 x 1 x 1     2,359,296  False     
________________________________________________________________
BatchNorm2d          64 x 512 x 1 x 1     1,024      True      
________________________________________________________________
AdaptiveAvgPool2d    64 x 512 x 1 x 1     0          False     
________________________________________________________________
AdaptiveMaxPool2d    64 x 512 x 1 x 1     0          False     
________________________________________________________________
Flatten              64 x 1024            0          False     
________________________________________________________________
BatchNorm1d          64 x 1024            2,048      True      
________________________________________________________________
Dropout              64 x 1024            0          False     
________________________________________________________________
Linear               64 x 512             524,288    True      
________________________________________________________________
ReLU                 64 x 512             0          False     
________________________________________________________________
BatchNorm1d          64 x 512             1,024      True      
________________________________________________________________
Dropout              64 x 512             0          False     
________________________________________________________________
Linear               64 x 2               1,024      True      
________________________________________________________________

Total params: 11,704,896
Total trainable params: 537,984
Total non-trainable params: 11,166,912

Optimizer used: &lt;function Adam at 0x1390a5200&gt;
Loss function: FlattenedLoss of CrossEntropyLoss()

Model frozen up to parameter group number 2

Callbacks:
  - TrainEvalCallback
  - Recorder
  - ProgressCallback
  - MyProfileCallback</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>MyProfileCallback</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Call the <code>print_stats</code> method on the <code>my_profile</code> attribute of the <code>Learner</code> object displays a hierarchical list of the training lifecycle events -- in this case with no data yet as the <code>fit</code> method has not been called.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fit has no data
   epoch has no data
      train has no data
         train_batch has no data
            train_pred has no data
            train_loss has no data
            train_backward has no data
            train_step has no data
            train_zero_grad has no data
      valid has no data
         valid_batch has no data
            valid_pred has no data
            valid_loss has no data
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.655225</td>
      <td>0.184525</td>
      <td>0.941345</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>print_stats</code> method now prints the execution counts, max time and avg time (in secs) for each part of the training lifecycle.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fit  called 1 times. max: 14.542 avg: 14.542
   epoch  called 1 times. max: 14.539 avg: 14.539
      train  called 1 times. max: 12.276 avg: 12.276
         train_batch  called 11 times. max: 1.159 avg: 1.076
            train_pred  called 11 times. max: 0.269 avg: 0.236
            train_loss  called 11 times. max: 0.001 avg: 0.001
            train_backward  called 11 times. max: 0.872 avg: 0.828
            train_step  called 11 times. max: 0.012 avg: 0.008
            train_zero_grad  called 11 times. max: 0.005 avg: 0.003
      valid  called 1 times. max: 2.256 avg: 2.256
         valid_batch  called 11 times. max: 0.208 avg: 0.183
            valid_pred  called 11 times. max: 0.201 avg: 0.180
            valid_loss  called 11 times. max: 0.001 avg: 0.001
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The stats can also be collected as a list of tuples where each tuple consists of the lifecycle event name, the level, and the elapsed times.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fit_stats</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">get_stats</span><span class="p">();</span><span class="n">fit_stats</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;fit&#39;, 0, [14.542369842529297]),
 (&#39;epoch&#39;, 1, [14.539028882980347]),
 (&#39;train&#39;, 2, [12.275759220123291]),
 (&#39;train_batch&#39;,
  3,
  [1.1590299606323242,
   1.1047968864440918,
   1.05731201171875,
   1.0566790103912354,
   1.0275590419769287,
   1.0583367347717285,
   1.0706360340118408,
   1.0878362655639648,
   1.0695040225982666,
   1.0548479557037354,
   1.0869989395141602]),
 (&#39;train_pred&#39;,
  4,
  [0.2687697410583496,
   0.2391033172607422,
   0.2244129180908203,
   0.2360670566558838,
   0.2223670482635498,
   0.23363089561462402,
   0.23241806030273438,
   0.2404940128326416,
   0.22686195373535156,
   0.22826123237609863,
   0.24588418006896973]),
 (&#39;train_loss&#39;,
  4,
  [0.0010721683502197266,
   0.0006809234619140625,
   0.0006620883941650391,
   0.0007491111755371094,
   0.0006761550903320312,
   0.000698089599609375,
   0.0007200241088867188,
   0.0008070468902587891,
   0.0006639957427978516,
   0.0006880760192871094,
   0.0007140636444091797]),
 (&#39;train_backward&#39;,
  4,
  [0.8724572658538818,
   0.8547101020812988,
   0.8222289085388184,
   0.8091421127319336,
   0.7942306995391846,
   0.8135287761688232,
   0.8273820877075195,
   0.8366448879241943,
   0.8316769599914551,
   0.8132097721099854,
   0.8283698558807373]),
 (&#39;train_step&#39;,
  4,
  [0.011558294296264648,
   0.0077021121978759766,
   0.0075457096099853516,
   0.007853031158447266,
   0.007728099822998047,
   0.00794076919555664,
   0.007550954818725586,
   0.0073511600494384766,
   0.007617950439453125,
   0.009986162185668945,
   0.00926518440246582]),
 (&#39;train_zero_grad&#39;,
  4,
  [0.005139350891113281,
   0.0025839805603027344,
   0.002447843551635742,
   0.0028531551361083984,
   0.002541065216064453,
   0.0025222301483154297,
   0.0025501251220703125,
   0.0025250911712646484,
   0.0026650428771972656,
   0.002687215805053711,
   0.002749919891357422]),
 (&#39;valid&#39;, 2, [2.2555930614471436]),
 (&#39;valid_batch&#39;,
  3,
  [0.20812106132507324,
   0.18181729316711426,
   0.187255859375,
   0.1778090000152588,
   0.18497300148010254,
   0.18157696723937988,
   0.18445587158203125,
   0.18021106719970703,
   0.1816089153289795,
   0.18120694160461426,
   0.16774797439575195]),
 (&#39;valid_pred&#39;,
  4,
  [0.20078110694885254,
   0.1788790225982666,
   0.18420696258544922,
   0.17487597465515137,
   0.18212318420410156,
   0.17869901657104492,
   0.18164587020874023,
   0.17727923393249512,
   0.1787278652191162,
   0.1784052848815918,
   0.16483402252197266]),
 (&#39;valid_loss&#39;,
  4,
  [0.001481771469116211,
   0.0005438327789306641,
   0.0005319118499755859,
   0.0005309581756591797,
   0.0005328655242919922,
   0.0005371570587158203,
   0.0005366802215576172,
   0.0005400180816650391,
   0.0005350112915039062,
   0.0005319118499755859,
   0.0005390644073486328])]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>print_stats</code> can also print just the stats for one lifecycle event</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="s1">&#39;train_batch&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>         train_batch  called 11 times. max: 1.159 avg: 1.076
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>get_stats</code> can also just collect the stats for one lifecycle event</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_batch_stats</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="s1">&#39;train_batch&#39;</span><span class="p">);</span> <span class="n">train_batch_stats</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;train_batch&#39;,
 3,
 [1.1590299606323242,
  1.1047968864440918,
  1.05731201171875,
  1.0566790103912354,
  1.0275590419769287,
  1.0583367347717285,
  1.0706360340118408,
  1.0878362655639648,
  1.0695040225982666,
  1.0548479557037354,
  1.0869989395141602])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Call the <code>clear_stats</code> to clear the stats. You can also pass a lifecycle event to clear a single event</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fit has no data
   epoch has no data
      train has no data
         train_batch has no data
            train_pred has no data
            train_loss has no data
            train_backward has no data
            train_step has no data
            train_zero_grad has no data
      valid has no data
         valid_batch has no data
            valid_pred has no data
            valid_loss has no data
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>      train has no data
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.974439</td>
      <td>0.237767</td>
      <td>0.924177</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.354515</td>
      <td>0.197183</td>
      <td>0.928469</td>
      <td>00:23</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fit  called 2 times. max: 22.964 avg: 18.613
   epoch  called 2 times. max: 22.960 avg: 18.609
      train  called 2 times. max: 20.698 avg: 16.336
         train_batch  called 22 times. max: 2.011 avg: 1.460
            train_pred  called 22 times. max: 0.280 avg: 0.232
            train_loss  called 22 times. max: 0.001 avg: 0.001
            train_backward  called 22 times. max: 1.540 avg: 1.165
            train_step  called 22 times. max: 0.195 avg: 0.057
            train_zero_grad  called 22 times. max: 0.010 avg: 0.005
      valid  called 2 times. max: 2.277 avg: 2.267
         valid_batch  called 22 times. max: 0.217 avg: 0.184
            valid_pred  called 22 times. max: 0.209 avg: 0.181
            valid_loss  called 22 times. max: 0.002 avg: 0.001
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="My-Profile-Reset-Attribute">My Profile Reset Attribute<a class="anchor-link" href="#My-Profile-Reset-Attribute"> </a></h5><p>Setting the <code>reset</code> attribute to true on the <code>my_profile</code> attribute will cause the stats to be reset each time the <code>fit</code> method of the <code>Learner</code> is called. So only the accumulated stats for the last call to <code>fit</code> (e.g <code>fine_tune</code> calls <code>fit</code> twice, but setting the <code>reset</code> attribute to true will show only the stats for the second <code>fit</code> call.
The default value of <code>reset</code> is <code>False</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.954453</td>
      <td>0.249635</td>
      <td>0.905579</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.354821</td>
      <td>0.196215</td>
      <td>0.932761</td>
      <td>00:23</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fit  called 1 times. max: 22.159 avg: 22.159
   epoch  called 1 times. max: 22.154 avg: 22.154
      train  called 1 times. max: 19.886 avg: 19.886
         train_batch  called 11 times. max: 1.939 avg: 1.784
            train_pred  called 11 times. max: 0.264 avg: 0.231
            train_loss  called 11 times. max: 0.001 avg: 0.001
            train_backward  called 11 times. max: 1.483 avg: 1.440
            train_step  called 11 times. max: 0.182 avg: 0.104
            train_zero_grad  called 11 times. max: 0.010 avg: 0.008
      valid  called 1 times. max: 2.263 avg: 2.263
         valid_batch  called 11 times. max: 0.205 avg: 0.184
            valid_pred  called 11 times. max: 0.198 avg: 0.180
            valid_loss  called 11 times. max: 0.002 avg: 0.001
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learner</span><span class="o">.</span><span class="n">my_profile</span><span class="o">.</span><span class="n">reset</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Enhanced-Image-Classifier-Cleaner">Enhanced Image Classifier Cleaner<a class="anchor-link" href="#Enhanced-Image-Classifier-Cleaner"> </a></h3><p>Import the utils -- You can either import all the utilities</p>

<pre><code>from my_timesaver_utils.all import *</code></pre>
<p>Or you can import only the enhanced image classifier cleaner package</p>

<pre><code>from my_timesaver_utils.enhanced_imageclassifiercleaner import *</code></pre>
<h4 id="Prerequisites">Prerequisites<a class="anchor-link" href="#Prerequisites"> </a></h4><p>In order to use the <a href="/my_timesaver_utils/enhanced_imageclassifiercleaner.html#EnhancedImageClassifierCleaner"><code>EnhancedImageClassifierCleaner</code></a> (just like the fastai <code>ImageClassifierCleaner</code>), we will need to have an existing fastai <code>Learner</code> object.</p>
<h4 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h4><p>Just create an instance of <a href="/my_timesaver_utils/enhanced_imageclassifiercleaner.html#EnhancedImageClassifierCleaner"><code>EnhancedImageClassifierCleaner</code></a> object.</p>

<pre><code>cleaner = EnhancedImageClassifierCleaner(learner)
cleaner # on a separate line, this will display the widget</code></pre>
<p>If you updated your dataset, you can refresh your dataloader by running</p>

<pre><code>newdls = datablock.dataloaders(path)
learner.dls = newdls # assume learner was previously created or loaded
cleaner = EnhancedImageClassifierCleaner(learner)</code></pre>
<p>This will then display the updated images from your dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cleaner</span> <span class="o">=</span> <span class="n">EnhancedImageClassifierCleaner</span><span class="p">(</span><span class="n">learner</span><span class="p">)</span>
<span class="n">cleaner</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/my_timesaver_utils/images/enhanced-image-classifiercleaner.png" alt="pic of enhanced-image-classifier-cleaner widget"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Custom-Valid/Train-folder-structures-and-labeled-categories">Custom Valid/Train folder structures and labeled categories<a class="anchor-link" href="#Custom-Valid/Train-folder-structures-and-labeled-categories"> </a></h4><p>The default folder structure for the Enhanced Image Classifier Cleaner 
assumes that you are using <code>RandomSplitter</code> or <code>GrandparentSplitter</code> as 
your <code>splitter</code> and <code>parent_label</code> as the <code>get_y</code> parameter in your datablock.</p>
<p>If you have a custom valid/train splitter and your image files are not segregated by categories within them,
you will need  to create a custom file mover in order to update your image labels (aka categories).</p>
<p>The default implementation of the <code>file_mover</code> is shown below:</p>

<pre><code>export
import shutil
def parent_move_file(fn, newcat):
    new_path = fn.parent.parent/newcat
    if new_path.is_dir():
        shutil.move(str(fn), new_path)
        new_file = new_path/fn.name
        return new_file
    return fn</code></pre>
<p>The default implementation will work with either a <code>RandomSplitter</code> or <code>GrandparentSplitter</code>
and if <code>parent_label</code> is used to get the labels.</p>
<p>Otherwise, you will need to modify the file_mover argument with a custom one
and pass it as follows</p>

<pre><code>cleaner = EnhancedImageClassifierCleaner(learner, file_mover=custom_file_mover)</code></pre>

</div>
</div>
</div>
</div>
 

